priority: 0
steps:
- 
    label: Build Base Image
    key: "build-base-image"
    agents:
      os: darwin
      arch: arm64
      tart: true
    command:
    - mkdir -p $HOME/.docker
    - cat > $HOME/.docker/config.json << EOF
    - |
      {
        "auths": {
          "ghcr.io": {
            "auth": "$(echo -n "$GITHUB_USERNAME:$GITHUB_TOKEN" | base64)"
          }
        }
      }
    - EOF
    - chmod 600 $HOME/.docker/config.json
    - echo "$GITHUB_TOKEN" > /tmp/github-token.txt
    - echo "$GITHUB_USERNAME" > /tmp/github-username.txt
    - chmod +x .buildkite/scripts/ensure-bun-image.sh
    - set -x
    - .buildkite/scripts/ensure-bun-image.sh 2>&1 | tee -a base-image-build.log
    - rm -f /tmp/github-token.txt /tmp/github-username.txt
    retry:
      automatic:
      - 
              exit_status: 1
              limit: 2
        
      - 
              exit_status: -1
              limit: 1
        
      - 
              exit_status: 255
              limit: 1
        
    artifact_paths:
    - base-image-build.log
    soft_fail: false
    timeout_in_minutes: 90
  
- 
    key: "darwin-aarch64-build-vendor"
    label: ":darwin: aarch64 - build-vendor"
    agents:
      os: darwin
      arch: arm64
      tart: true
    retry:
      manual:
        permit_on_passed: true
      automatic:
      - 
              exit_status: 1
              limit: 0
        
      - 
              exit_status: -1
              limit: 1
        
      - 
              exit_status: 255
              limit: 1
        
      - 
              signal_reason: cancel
              limit: 1
        
      - 
              signal_reason: agent_stop
              limit: 1
        
    cancel_on_build_failing: false
    env:
      ENABLE_BASELINE: OFF
      ENABLE_CANARY: ON
      CANARY_REVISION: 1
      CMAKE_VERBOSE_MAKEFILE: ON
      CMAKE_TLS_VERIFY: 0
    command:
    - tart list | awk '/stopped/ && $1 == "local" && $2 ~ /^bun-build-[0-9]+-[0-9a-f-]+$/ {print $2}' | xargs -n1 tart delete || true
    - log stream --predicate 'process == "tart" OR process CONTAINS "Virtualization"' > tart.log 2>&1 &
    - TART_LOG_PID=$!
    - trap 'if [ -n "$TART_LOG_PID" ]; then kill $TART_LOG_PID 2>/dev/null || true; fi; buildkite-agent artifact upload tart.log || true' EXIT
    - tart clone bun-build-macos-1.2.14 bun-build-1748825543738-28ebf9ce-25a7-4551-b234-73163afab5cc
    - tart run bun-build-1748825543738-28ebf9ce-25a7-4551-b234-73163afab5cc --no-graphics --dir=workspace:$PWD > vm.log 2>&1 &
    - sleep 30
    - chmod +x .buildkite/scripts/run-vm-command.sh
    - .buildkite/scripts/run-vm-command.sh bun-build-1748825543738-28ebf9ce-25a7-4551-b234-73163afab5cc "cd '/Volumes/My Shared Files/workspace' && ls -la && bun run build:release --target dependencies"
    - buildkite-agent artifact upload vm.log || echo "No VM log to upload"
    - tart delete bun-build-1748825543738-28ebf9ce-25a7-4551-b234-73163afab5cc
    depends_on:
    - build-base-image
  
- 
    key: "darwin-aarch64-build-cpp"
    label: ":darwin: aarch64 - build-cpp"
    agents:
      os: darwin
      arch: arm64
      tart: true
    retry:
      manual:
        permit_on_passed: true
      automatic:
      - 
              exit_status: 1
              limit: 0
        
      - 
              exit_status: -1
              limit: 1
        
      - 
              exit_status: 255
              limit: 1
        
      - 
              signal_reason: cancel
              limit: 1
        
      - 
              signal_reason: agent_stop
              limit: 1
        
    cancel_on_build_failing: false
    env:
      BUN_CPP_ONLY: ON
      ENABLE_BASELINE: OFF
      ENABLE_CANARY: ON
      CANARY_REVISION: 1
      CMAKE_VERBOSE_MAKEFILE: ON
      CMAKE_TLS_VERIFY: 0
    command:
    - tart list | awk '/stopped/ && $1 == "local" && $2 ~ /^bun-build-[0-9]+-[0-9a-f-]+$/ {print $2}' | xargs -n1 tart delete || true
    - log stream --predicate 'process == "tart" OR process CONTAINS "Virtualization"' > tart.log 2>&1 &
    - TART_LOG_PID=$!
    - trap 'if [ -n "$TART_LOG_PID" ]; then kill $TART_LOG_PID 2>/dev/null || true; fi; buildkite-agent artifact upload tart.log || true' EXIT
    - tart clone bun-build-macos-1.2.14 bun-build-1748825543744-81c59b59-4427-4387-883b-e4cf6600c54e
    - tart run bun-build-1748825543744-81c59b59-4427-4387-883b-e4cf6600c54e --no-graphics --dir=workspace:$PWD > vm.log 2>&1 &
    - sleep 30
    - chmod +x .buildkite/scripts/run-vm-command.sh
    - .buildkite/scripts/run-vm-command.sh bun-build-1748825543744-81c59b59-4427-4387-883b-e4cf6600c54e "cd '/Volumes/My Shared Files/workspace' && bun run build:release --target bun"
    - .buildkite/scripts/run-vm-command.sh bun-build-1748825543744-81c59b59-4427-4387-883b-e4cf6600c54e "cd '/Volumes/My Shared Files/workspace' && bun run build:release --target dependencies"
    - buildkite-agent artifact upload vm.log || echo "No VM log to upload"
    - tart delete bun-build-1748825543744-81c59b59-4427-4387-883b-e4cf6600c54e
    depends_on:
    - build-base-image
  
- 
    key: "darwin-aarch64-build-zig"
    label: ":darwin: aarch64 - build-zig"
    agents:
      os: darwin
      arch: arm64
      tart: true
    retry:
      manual:
        permit_on_passed: true
      automatic:
      - 
              exit_status: 1
              limit: 0
        
      - 
              exit_status: -1
              limit: 1
        
      - 
              exit_status: 255
              limit: 1
        
      - 
              signal_reason: cancel
              limit: 1
        
      - 
              signal_reason: agent_stop
              limit: 1
        
    cancel_on_build_failing: false
    env:
      ENABLE_BASELINE: OFF
      ENABLE_CANARY: ON
      CANARY_REVISION: 1
      CMAKE_VERBOSE_MAKEFILE: ON
      CMAKE_TLS_VERIFY: 0
    timeout_in_minutes: 35
    command:
    - tart list | awk '/stopped/ && $1 == "local" && $2 ~ /^bun-build-[0-9]+-[0-9a-f-]+$/ {print $2}' | xargs -n1 tart delete || true
    - log stream --predicate 'process == "tart" OR process CONTAINS "Virtualization"' > tart.log 2>&1 &
    - TART_LOG_PID=$!
    - trap 'if [ -n "$TART_LOG_PID" ]; then kill $TART_LOG_PID 2>/dev/null || true; fi; buildkite-agent artifact upload tart.log || true' EXIT
    - tart clone bun-build-macos-1.2.14 bun-build-1748825543750-d65a22a6-18d4-4865-bc07-b5487d26a975
    - tart run bun-build-1748825543750-d65a22a6-18d4-4865-bc07-b5487d26a975 --no-graphics --dir=workspace:$PWD > vm.log 2>&1 &
    - sleep 30
    - chmod +x .buildkite/scripts/run-vm-command.sh
    - .buildkite/scripts/run-vm-command.sh bun-build-1748825543750-d65a22a6-18d4-4865-bc07-b5487d26a975 "cd '/Volumes/My Shared Files/workspace' && bun run build:release --target bun-zig --toolchain darwin-aarch64"
    - buildkite-agent artifact upload vm.log || echo "No VM log to upload"
    - tart delete bun-build-1748825543750-d65a22a6-18d4-4865-bc07-b5487d26a975
    depends_on:
    - build-base-image
  
- 
    key: "darwin-aarch64-build-bun"
    label: ":darwin: aarch64 - build-bun"
    depends_on:
    - darwin-aarch64-build-cpp
    - darwin-aarch64-build-zig
    - build-base-image
    agents:
      os: darwin
      arch: arm64
      tart: true
    retry:
      manual:
        permit_on_passed: true
      automatic:
      - 
              exit_status: 1
              limit: 0
        
      - 
              exit_status: -1
              limit: 1
        
      - 
              exit_status: 255
              limit: 1
        
      - 
              signal_reason: cancel
              limit: 1
        
      - 
              signal_reason: agent_stop
              limit: 1
        
    cancel_on_build_failing: false
    env:
      BUN_LINK_ONLY: ON
      ENABLE_BASELINE: OFF
      ENABLE_CANARY: ON
      CANARY_REVISION: 1
      CMAKE_VERBOSE_MAKEFILE: ON
      CMAKE_TLS_VERIFY: 0
    command:
    - tart list | awk '/stopped/ && $1 == "local" && $2 ~ /^bun-build-[0-9]+-[0-9a-f-]+$/ {print $2}' | xargs -n1 tart delete || true
    - log stream --predicate 'process == "tart" OR process CONTAINS "Virtualization"' > tart.log 2>&1 &
    - TART_LOG_PID=$!
    - trap 'if [ -n "$TART_LOG_PID" ]; then kill $TART_LOG_PID 2>/dev/null || true; fi; buildkite-agent artifact upload tart.log || true' EXIT
    - tart clone bun-build-macos-1.2.14 bun-build-1748825543756-a917bb79-b0be-4a6b-aa5f-25c9ef3181fd
    - tart run bun-build-1748825543756-a917bb79-b0be-4a6b-aa5f-25c9ef3181fd --no-graphics --dir=workspace:$PWD > vm.log 2>&1 &
    - sleep 30
    - chmod +x .buildkite/scripts/run-vm-command.sh
    - .buildkite/scripts/run-vm-command.sh bun-build-1748825543756-a917bb79-b0be-4a6b-aa5f-25c9ef3181fd "cd '/Volumes/My Shared Files/workspace' && bun run build:release --target bun"
    - buildkite-agent artifact upload vm.log || echo "No VM log to upload"
    - tart delete bun-build-1748825543756-a917bb79-b0be-4a6b-aa5f-25c9ef3181fd
  
- 
    key: "darwin-x64-build-vendor"
    label: ":darwin: x64 - build-vendor"
    agents:
      os: darwin
      arch: x64
      tart: true
    retry:
      manual:
        permit_on_passed: true
      automatic:
      - 
              exit_status: 1
              limit: 0
        
      - 
              exit_status: -1
              limit: 1
        
      - 
              exit_status: 255
              limit: 1
        
      - 
              signal_reason: cancel
              limit: 1
        
      - 
              signal_reason: agent_stop
              limit: 1
        
    cancel_on_build_failing: false
    env:
      ENABLE_BASELINE: OFF
      ENABLE_CANARY: ON
      CANARY_REVISION: 1
      CMAKE_VERBOSE_MAKEFILE: ON
      CMAKE_TLS_VERIFY: 0
    command:
    - tart list | awk '/stopped/ && $1 == "local" && $2 ~ /^bun-build-[0-9]+-[0-9a-f-]+$/ {print $2}' | xargs -n1 tart delete || true
    - log stream --predicate 'process == "tart" OR process CONTAINS "Virtualization"' > tart.log 2>&1 &
    - TART_LOG_PID=$!
    - trap 'if [ -n "$TART_LOG_PID" ]; then kill $TART_LOG_PID 2>/dev/null || true; fi; buildkite-agent artifact upload tart.log || true' EXIT
    - tart clone bun-build-macos-1.2.14 bun-build-1748825543761-fc492cb2-d208-4076-861d-d1e39480dff2
    - tart run bun-build-1748825543761-fc492cb2-d208-4076-861d-d1e39480dff2 --no-graphics --dir=workspace:$PWD > vm.log 2>&1 &
    - sleep 30
    - chmod +x .buildkite/scripts/run-vm-command.sh
    - .buildkite/scripts/run-vm-command.sh bun-build-1748825543761-fc492cb2-d208-4076-861d-d1e39480dff2 "cd '/Volumes/My Shared Files/workspace' && ls -la && bun run build:release --target dependencies"
    - buildkite-agent artifact upload vm.log || echo "No VM log to upload"
    - tart delete bun-build-1748825543761-fc492cb2-d208-4076-861d-d1e39480dff2
    depends_on:
    - build-base-image
  
- 
    key: "darwin-x64-build-cpp"
    label: ":darwin: x64 - build-cpp"
    agents:
      os: darwin
      arch: x64
      tart: true
    retry:
      manual:
        permit_on_passed: true
      automatic:
      - 
              exit_status: 1
              limit: 0
        
      - 
              exit_status: -1
              limit: 1
        
      - 
              exit_status: 255
              limit: 1
        
      - 
              signal_reason: cancel
              limit: 1
        
      - 
              signal_reason: agent_stop
              limit: 1
        
    cancel_on_build_failing: false
    env:
      BUN_CPP_ONLY: ON
      ENABLE_BASELINE: OFF
      ENABLE_CANARY: ON
      CANARY_REVISION: 1
      CMAKE_VERBOSE_MAKEFILE: ON
      CMAKE_TLS_VERIFY: 0
    command:
    - tart list | awk '/stopped/ && $1 == "local" && $2 ~ /^bun-build-[0-9]+-[0-9a-f-]+$/ {print $2}' | xargs -n1 tart delete || true
    - log stream --predicate 'process == "tart" OR process CONTAINS "Virtualization"' > tart.log 2>&1 &
    - TART_LOG_PID=$!
    - trap 'if [ -n "$TART_LOG_PID" ]; then kill $TART_LOG_PID 2>/dev/null || true; fi; buildkite-agent artifact upload tart.log || true' EXIT
    - tart clone bun-build-macos-1.2.14 bun-build-1748825543766-96cf8d79-57b0-4487-925c-21a6b2799959
    - tart run bun-build-1748825543766-96cf8d79-57b0-4487-925c-21a6b2799959 --no-graphics --dir=workspace:$PWD > vm.log 2>&1 &
    - sleep 30
    - chmod +x .buildkite/scripts/run-vm-command.sh
    - .buildkite/scripts/run-vm-command.sh bun-build-1748825543766-96cf8d79-57b0-4487-925c-21a6b2799959 "cd '/Volumes/My Shared Files/workspace' && bun run build:release --target bun"
    - .buildkite/scripts/run-vm-command.sh bun-build-1748825543766-96cf8d79-57b0-4487-925c-21a6b2799959 "cd '/Volumes/My Shared Files/workspace' && bun run build:release --target dependencies"
    - buildkite-agent artifact upload vm.log || echo "No VM log to upload"
    - tart delete bun-build-1748825543766-96cf8d79-57b0-4487-925c-21a6b2799959
    depends_on:
    - build-base-image
  
- 
    key: "darwin-x64-build-zig"
    label: ":darwin: x64 - build-zig"
    agents:
      os: darwin
      arch: x64
      tart: true
    retry:
      manual:
        permit_on_passed: true
      automatic:
      - 
              exit_status: 1
              limit: 0
        
      - 
              exit_status: -1
              limit: 1
        
      - 
              exit_status: 255
              limit: 1
        
      - 
              signal_reason: cancel
              limit: 1
        
      - 
              signal_reason: agent_stop
              limit: 1
        
    cancel_on_build_failing: false
    env:
      ENABLE_BASELINE: OFF
      ENABLE_CANARY: ON
      CANARY_REVISION: 1
      CMAKE_VERBOSE_MAKEFILE: ON
      CMAKE_TLS_VERIFY: 0
    timeout_in_minutes: 35
    command:
    - tart list | awk '/stopped/ && $1 == "local" && $2 ~ /^bun-build-[0-9]+-[0-9a-f-]+$/ {print $2}' | xargs -n1 tart delete || true
    - log stream --predicate 'process == "tart" OR process CONTAINS "Virtualization"' > tart.log 2>&1 &
    - TART_LOG_PID=$!
    - trap 'if [ -n "$TART_LOG_PID" ]; then kill $TART_LOG_PID 2>/dev/null || true; fi; buildkite-agent artifact upload tart.log || true' EXIT
    - tart clone bun-build-macos-1.2.14 bun-build-1748825543772-28bfacca-54b5-4624-98d6-250fd29c7db1
    - tart run bun-build-1748825543772-28bfacca-54b5-4624-98d6-250fd29c7db1 --no-graphics --dir=workspace:$PWD > vm.log 2>&1 &
    - sleep 30
    - chmod +x .buildkite/scripts/run-vm-command.sh
    - .buildkite/scripts/run-vm-command.sh bun-build-1748825543772-28bfacca-54b5-4624-98d6-250fd29c7db1 "cd '/Volumes/My Shared Files/workspace' && bun run build:release --target bun-zig --toolchain darwin-x64"
    - buildkite-agent artifact upload vm.log || echo "No VM log to upload"
    - tart delete bun-build-1748825543772-28bfacca-54b5-4624-98d6-250fd29c7db1
    depends_on:
    - build-base-image
  
- 
    key: "darwin-x64-build-bun"
    label: ":darwin: x64 - build-bun"
    depends_on:
    - darwin-x64-build-cpp
    - darwin-x64-build-zig
    - build-base-image
    agents:
      os: darwin
      arch: x64
      tart: true
    retry:
      manual:
        permit_on_passed: true
      automatic:
      - 
              exit_status: 1
              limit: 0
        
      - 
              exit_status: -1
              limit: 1
        
      - 
              exit_status: 255
              limit: 1
        
      - 
              signal_reason: cancel
              limit: 1
        
      - 
              signal_reason: agent_stop
              limit: 1
        
    cancel_on_build_failing: false
    env:
      BUN_LINK_ONLY: ON
      ENABLE_BASELINE: OFF
      ENABLE_CANARY: ON
      CANARY_REVISION: 1
      CMAKE_VERBOSE_MAKEFILE: ON
      CMAKE_TLS_VERIFY: 0
    command:
    - tart list | awk '/stopped/ && $1 == "local" && $2 ~ /^bun-build-[0-9]+-[0-9a-f-]+$/ {print $2}' | xargs -n1 tart delete || true
    - log stream --predicate 'process == "tart" OR process CONTAINS "Virtualization"' > tart.log 2>&1 &
    - TART_LOG_PID=$!
    - trap 'if [ -n "$TART_LOG_PID" ]; then kill $TART_LOG_PID 2>/dev/null || true; fi; buildkite-agent artifact upload tart.log || true' EXIT
    - tart clone bun-build-macos-1.2.14 bun-build-1748825543776-e85f1b15-d399-4f7b-975b-ca27a488ed64
    - tart run bun-build-1748825543776-e85f1b15-d399-4f7b-975b-ca27a488ed64 --no-graphics --dir=workspace:$PWD > vm.log 2>&1 &
    - sleep 30
    - chmod +x .buildkite/scripts/run-vm-command.sh
    - .buildkite/scripts/run-vm-command.sh bun-build-1748825543776-e85f1b15-d399-4f7b-975b-ca27a488ed64 "cd '/Volumes/My Shared Files/workspace' && bun run build:release --target bun"
    - buildkite-agent artifact upload vm.log || echo "No VM log to upload"
    - tart delete bun-build-1748825543776-e85f1b15-d399-4f7b-975b-ca27a488ed64
  
- 
    key: "darwin-aarch64-14-test-bun"
    label: ":darwin: 14 aarch64 - test-bun"
    depends_on:
    - darwin-aarch64-build-bun
    - build-base-image
    agents:
      os: darwin
      arch: arm64
      tart: true
    retry:
      manual:
        permit_on_passed: true
      automatic:
      - 
              exit_status: 1
              limit: 0
        
      - 
              exit_status: -1
              limit: 1
        
      - 
              exit_status: 255
              limit: 1
        
      - 
              signal_reason: cancel
              limit: 1
        
      - 
              signal_reason: agent_stop
              limit: 1
        
    cancel_on_build_failing: false
    parallelism: 2
    timeout_in_minutes: 30
    command:
    - tart list | awk '/stopped/ && $1 == "local" && $2 ~ /^bun-build-[0-9]+-[0-9a-f-]+$/ {print $2}' | xargs -n1 tart delete || true
    - log stream --predicate 'process == "tart" OR process CONTAINS "Virtualization"' > tart.log 2>&1 &
    - TART_LOG_PID=$!
    - trap 'if [ -n "$TART_LOG_PID" ]; then kill $TART_LOG_PID 2>/dev/null || true; fi; buildkite-agent artifact upload tart.log || true' EXIT
    - tart clone bun-build-macos-1.2.14 bun-build-1748825543782-68885923-4be4-4392-9786-a8f88f28d27b
    - tart run bun-build-1748825543782-68885923-4be4-4392-9786-a8f88f28d27b --no-graphics --dir=workspace:$PWD > vm.log 2>&1 &
    - sleep 30
    - chmod +x .buildkite/scripts/run-vm-command.sh
    - .buildkite/scripts/run-vm-command.sh bun-build-1748825543782-68885923-4be4-4392-9786-a8f88f28d27b "cd '/Volumes/My Shared Files/workspace' && ./scripts/runner.node.mjs --step=darwin-aarch64-build-bun"
    - buildkite-agent artifact upload vm.log || echo "No VM log to upload"
    - tart delete bun-build-1748825543782-68885923-4be4-4392-9786-a8f88f28d27b
  
- 
    key: "darwin-aarch64-13-test-bun"
    label: ":darwin: 13 aarch64 - test-bun"
    depends_on:
    - darwin-aarch64-build-bun
    - build-base-image
    agents:
      os: darwin
      arch: arm64
      tart: true
    retry:
      manual:
        permit_on_passed: true
      automatic:
      - 
              exit_status: 1
              limit: 0
        
      - 
              exit_status: -1
              limit: 1
        
      - 
              exit_status: 255
              limit: 1
        
      - 
              signal_reason: cancel
              limit: 1
        
      - 
              signal_reason: agent_stop
              limit: 1
        
    cancel_on_build_failing: false
    parallelism: 2
    timeout_in_minutes: 30
    command:
    - tart list | awk '/stopped/ && $1 == "local" && $2 ~ /^bun-build-[0-9]+-[0-9a-f-]+$/ {print $2}' | xargs -n1 tart delete || true
    - log stream --predicate 'process == "tart" OR process CONTAINS "Virtualization"' > tart.log 2>&1 &
    - TART_LOG_PID=$!
    - trap 'if [ -n "$TART_LOG_PID" ]; then kill $TART_LOG_PID 2>/dev/null || true; fi; buildkite-agent artifact upload tart.log || true' EXIT
    - tart clone bun-build-macos-1.2.14 bun-build-1748825543786-11aea6a5-2934-4126-a7fd-23a77eaf4c47
    - tart run bun-build-1748825543786-11aea6a5-2934-4126-a7fd-23a77eaf4c47 --no-graphics --dir=workspace:$PWD > vm.log 2>&1 &
    - sleep 30
    - chmod +x .buildkite/scripts/run-vm-command.sh
    - .buildkite/scripts/run-vm-command.sh bun-build-1748825543786-11aea6a5-2934-4126-a7fd-23a77eaf4c47 "cd '/Volumes/My Shared Files/workspace' && ./scripts/runner.node.mjs --step=darwin-aarch64-build-bun"
    - buildkite-agent artifact upload vm.log || echo "No VM log to upload"
    - tart delete bun-build-1748825543786-11aea6a5-2934-4126-a7fd-23a77eaf4c47
  
- 
    key: "darwin-x64-14-test-bun"
    label: ":darwin: 14 x64 - test-bun"
    depends_on:
    - darwin-x64-build-bun
    - build-base-image
    agents:
      os: darwin
      arch: x64
      tart: true
    retry:
      manual:
        permit_on_passed: true
      automatic:
      - 
              exit_status: 1
              limit: 0
        
      - 
              exit_status: -1
              limit: 1
        
      - 
              exit_status: 255
              limit: 1
        
      - 
              signal_reason: cancel
              limit: 1
        
      - 
              signal_reason: agent_stop
              limit: 1
        
    cancel_on_build_failing: false
    parallelism: 2
    timeout_in_minutes: 30
    command:
    - tart list | awk '/stopped/ && $1 == "local" && $2 ~ /^bun-build-[0-9]+-[0-9a-f-]+$/ {print $2}' | xargs -n1 tart delete || true
    - log stream --predicate 'process == "tart" OR process CONTAINS "Virtualization"' > tart.log 2>&1 &
    - TART_LOG_PID=$!
    - trap 'if [ -n "$TART_LOG_PID" ]; then kill $TART_LOG_PID 2>/dev/null || true; fi; buildkite-agent artifact upload tart.log || true' EXIT
    - tart clone bun-build-macos-1.2.14 bun-build-1748825543790-7610c3aa-79af-4145-afdb-32375a25cf0d
    - tart run bun-build-1748825543790-7610c3aa-79af-4145-afdb-32375a25cf0d --no-graphics --dir=workspace:$PWD > vm.log 2>&1 &
    - sleep 30
    - chmod +x .buildkite/scripts/run-vm-command.sh
    - .buildkite/scripts/run-vm-command.sh bun-build-1748825543790-7610c3aa-79af-4145-afdb-32375a25cf0d "cd '/Volumes/My Shared Files/workspace' && ./scripts/runner.node.mjs --step=darwin-x64-build-bun"
    - buildkite-agent artifact upload vm.log || echo "No VM log to upload"
    - tart delete bun-build-1748825543790-7610c3aa-79af-4145-afdb-32375a25cf0d
  
- 
    key: "darwin-x64-13-test-bun"
    label: ":darwin: 13 x64 - test-bun"
    depends_on:
    - darwin-x64-build-bun
    - build-base-image
    agents:
      os: darwin
      arch: x64
      tart: true
    retry:
      manual:
        permit_on_passed: true
      automatic:
      - 
              exit_status: 1
              limit: 0
        
      - 
              exit_status: -1
              limit: 1
        
      - 
              exit_status: 255
              limit: 1
        
      - 
              signal_reason: cancel
              limit: 1
        
      - 
              signal_reason: agent_stop
              limit: 1
        
    cancel_on_build_failing: false
    parallelism: 2
    timeout_in_minutes: 30
    command:
    - tart list | awk '/stopped/ && $1 == "local" && $2 ~ /^bun-build-[0-9]+-[0-9a-f-]+$/ {print $2}' | xargs -n1 tart delete || true
    - log stream --predicate 'process == "tart" OR process CONTAINS "Virtualization"' > tart.log 2>&1 &
    - TART_LOG_PID=$!
    - trap 'if [ -n "$TART_LOG_PID" ]; then kill $TART_LOG_PID 2>/dev/null || true; fi; buildkite-agent artifact upload tart.log || true' EXIT
    - tart clone bun-build-macos-1.2.14 bun-build-1748825543795-f158877d-5157-4259-8f79-db069a2f658c
    - tart run bun-build-1748825543795-f158877d-5157-4259-8f79-db069a2f658c --no-graphics --dir=workspace:$PWD > vm.log 2>&1 &
    - sleep 30
    - chmod +x .buildkite/scripts/run-vm-command.sh
    - .buildkite/scripts/run-vm-command.sh bun-build-1748825543795-f158877d-5157-4259-8f79-db069a2f658c "cd '/Volumes/My Shared Files/workspace' && ./scripts/runner.node.mjs --step=darwin-x64-build-bun"
    - buildkite-agent artifact upload vm.log || echo "No VM log to upload"
    - tart delete bun-build-1748825543795-f158877d-5157-4259-8f79-db069a2f658c
  
- 
    key: release
    label: ":rocket:"
    agents:
      os: darwin
      arch: arm64
      tart: true
    depends_on:
    - darwin-aarch64-build-bun
    - darwin-x64-build-bun
    env:
      CANARY: 1
    command: ".buildkite/scripts/upload-release.sh"
  
- 
    key: benchmark
    label: 📊
    agents:
      os: darwin
      arch: arm64
      tart: true
    depends_on: "linux-x64-build-bun"
    command: "node .buildkite/scripts/upload-benchmark.mjs"
  
