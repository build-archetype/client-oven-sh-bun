#!/bin/bash
# Title: Automate Mac CI Setup
# Author: samwardbiddle
# Description: Runs the setup script with secrets on a Mac using Bash Bunny

LED SETUP

# Set attack mode to storage and keyboard
ATTACKMODE HID STORAGE

# Wait for the system to mount the Bash Bunny storage
LED STAGE1
sleep 5

# Open Terminal
Q GUI SPACE
Q DELAY 500
Q STRING Terminal
Q ENTER
Q DELAY 1000

# Run the setup script with env vars
Q STRING "cd /Volumes/BashBunny"
Q ENTER
Q DELAY 500
Q STRING "source automate-setup.sh"
Q ENTER
Q DELAY 500
Q STRING "curl -fsSL -o setup-mac-server.sh https://raw.githubusercontent.com/oven-sh/bun/main/infrastructure/setup/setup-mac-server.sh"
Q ENTER
Q DELAY 1000
Q STRING "chmod +x setup-mac-server.sh"
Q ENTER
Q DELAY 500
Q STRING "./setup-mac-server.sh | tee setup-mac-server.log"
Q ENTER

LED FINISH